(function(b){jQuery.fn.mrs2000box=function(a){function M(){g=b(".m2b-shadow");0==g.length?(g=b('<div class="m2b-shadow"></div>'),g.appendTo("body").click(r),c=b('<div class="m2b-frame"><div class="m2b-shadow2"></div><div class="m2b-spinner"><div class="m2b-double-bounce1"></div><div class="m2b-double-bounce2"></div></div><img class="m2b-image"><div class="m2b-error"></div><div class="m2b-left"></div><div class="m2b-right"></div><div class="m2b-btn-close"></div><div class="m2b-title"></div></div>'),
c.appendTo("body")):(c=b(".m2b-frame"),c.show(),g.show());t=c.find(".m2b-spinner");h=c.find(".m2b-image");h.hide().load(function(){if(a.showNumber||a.showTitle)C=!0,k.show();D();t.hide()}).click(function(){(2>d.length||!a.showGallery)&&r()});l=c.find(".m2b-left");m=c.find(".m2b-right");l.click(E);m.click(F);k=c.find(".m2b-title");(a.showTitle||a.showNumber)&&k.show();u=c.find(".m2b-error");u.hide();y=c.find(".m2b-btn-close");y.click(r);e=new Image;e.onload=function(){n?(v=e.naturalWidth,w=e.naturalHeight,
h.attr("src",e.src).show(),G()):n=!0};e.onerror=function(){n&&(u.show(),h.hide(),t.hide(),G())};b(window).bind("resize",H);b(document).bind("keyup",I)}function H(){x&&D()}function I(p){if(x)switch(p.which){case 27:r();break;case 37:E();break;case 39:F()}}function D(){var p=c.width(),a=c.height(),d=v/w,b,q;C&&(a-=k.outerHeight());1<d?(b=v>p?p:v,q=b/d):(q=w>a?a:w,b=q*d);h.css({top:.5*a-.5*q,left:.5*p-.5*b,width:b,height:q})}function z(){(a.showTitle||a.showNumber)&&k.html(d[f].title).hide();h.hide();
t.show();u.hide();n=!0;A=f;e.src=d[f].href}function G(){1<d.length&&(n=!1,A=1==B?J():K(),e.src=d[A].href)}function K(){var a=f-1;-1==a&&(a=d.length-1);return a}function J(){var a=f+1;a==d.length&&(a=0);return a}function E(){1<d.length&&a.showGallery&&(B=0,f=K(),z())}function F(){1<d.length&&a.showGallery&&(B=1,f=J(),z())}function L(b){var d="";a.showNumber&&b.rel&&(d+="<b>\u0424\u043e\u0442\u043e \u2116"+b.rel+"</b> ");return d+b.title}function r(){g.hide();c.hide();l.unbind("click");m.unbind("click");
y.unbind("click");b(window).unbind("resize",H);b(document).unbind("keyup",I);x=!1}a=b.extend({showTitle:!0,showNumber:!0,showGallery:!1,advanced:!1},a);a.advanced&&(a.showGallery=!0,a.showTitle=!0,a.showNumber=!0);var t=null,g=null,h=null,c=null,l=null,m=null,y=null,k=null,u=null,d=[],f=0,e=null,B=1,v,w,C,x=!1,n=!0,A;return b(this).each(function(){var c;if("A"==this.tagName){c=b(this).parent();if(c.data("m2b"))return;c.data("m2b",!0)}else c=b(this);c.on("click","a",function(b){b.preventDefault();
M();d=[];if(a.showGallery){var e=this;c.find("a").each(function(a,b){b==e&&(f=a);d.push({href:b.href,title:L(b)})})}else d.push({href:this.href,title:L(this)});1<d.length&&a.showGallery?(l.show(),m.show()):(l.hide(),m.hide());z();x=!0})})}})(jQuery);