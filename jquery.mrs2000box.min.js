(function(c){jQuery.fn.mrs2000box=function(a,D){function R(){k=c(".m2b-shadow");0==k.length?(k=c('<div class="m2b-shadow"></div>'),k.appendTo("body").click(u),e=c('<div class="m2b-frame"><div class="m2b-shadow2"></div><div class="m2b-spinner"><div class="m2b-double-bounce1"></div><div class="m2b-double-bounce2"></div></div><img class="m2b-image"><div class="m2b-error"></div><div class="m2b-left"></div><div class="m2b-right"></div><div class="m2b-btn-close"></div><div class="m2b-title"></div></div>'),
e.appendTo("body")):(e=c(".m2b-frame"),e.show(),k.show());v=e.find(".m2b-spinner");g=e.find(".m2b-image");g.hide().load(S).click(E);e.click(E);q=e.find(".m2b-left");r=e.find(".m2b-right");q.click(F);r.click(G);l=e.find(".m2b-title");(a.showTitle||a.showNumber)&&l.show();w=e.find(".m2b-error");w.hide();z=e.find(".m2b-btn-close");z.click(u);h=new Image;h.onload=function(){t?(m=h.naturalWidth,n=h.naturalHeight,g.attr("src",h.src).show(),H()):t=!0};h.onerror=function(){t&&(w.show(),g.hide(),v.hide(),
H())};c(window).bind("resize",I);c(document).bind("keyup",J)}function I(){if(x&&(K(),a.onResize))a.onResize({width:m,height:n,object:d[f].object,img:g})}function J(b){if(x)switch(b.which){case 27:u();break;case 37:F();break;case 39:G()}}function K(){var b=e.width(),a=e.height(),d=m/n,c,f;L&&(a-=l.outerHeight());d>b/a?(c=m>b?b:m,f=c/d):(f=n>a?a:n,c=f*d);g.css({top:.5*a-.5*f,left:.5*b-.5*c,width:c,height:f})}function S(){""!=l.html()&&(L=!0,l.show());if(a.onLoad)a.onLoad({width:m,height:n,object:d[f].object,
img:this});K();v.hide()}function E(){(2>d.length||!a.showGallery)&&u()}function A(){if(a.onBeforeLoad)a.onBeforeLoad({img:g});(a.showTitle||a.showNumber)&&l.html(d[f].title).hide();g.hide();v.show();w.hide();t=!0;B=f;h.src=d[f].href}function H(){1<d.length&&(t=!1,B=1==C?M():N(),h.src=d[B].href)}function N(){var b=f-1;-1==b&&(b=d.length-1);return b}function M(){var b=f+1;b==d.length&&(b=0);return b}function F(){1<d.length&&a.showGallery&&(C=0,f=N(),A())}function G(){1<d.length&&a.showGallery&&(C=1,
f=M(),A())}function O(b){var c="";a.showNumber&&b.rel&&(c+="<b>\u0424\u043e\u0442\u043e \u2116"+b.rel+"</b> ");return c+b.title}function P(b){if("A"==b.tagName){b=c(b).parent();if(b.data("m2b"))return;b.data("m2b-wrapper",!0)}else b=c(b);b.data("m2b",!0);return b}function Q(b,c){R();d=[];a.showGallery?b.find("a").each(function(b,a){a==c&&(f=b);d.push({object:a,href:a.href,title:O(a)})}):d.push({object:c,href:c.href,title:O(c)});1<d.length&&a.showGallery?(q.show(),r.show()):(q.hide(),r.hide());A();
x=!0}function u(){k.hide();e.hide();q.unbind("click");r.unbind("click");z.unbind("click");g.unbind("load");g.unbind("click");e.unbind("click");c(window).unbind("resize",I);c(document).unbind("keyup",J);x=!1;if(a.onClose)a.onClose()}var v=null,k=null,g=null,e=null,q=null,r=null,z=null,l=null,w=null,d=[],f=0,h=null,C=1,m,n,L,x=!1,t=!0,B;if(c.isPlainObject(a))return a=c.extend({showTitle:!0,showNumber:!0,showGallery:!1,advanced:!1,onBeforeLoad:null,onLoad:null,onResize:null,onClose:null},a),a.advanced&&
(a.showGallery=!0,a.showTitle=!0,a.showNumber=!0),c(this).each(function(){var b=P(this);b&&(b.data("m2b-options",a),b.on("click","a",function(a){a.preventDefault();Q(b,this)}))});var p=P(this);if(p&&"show"===a){var y="undefined"===typeof D?0:D,y=p.data("m2b-wrapper")?p.find("a").eq(y):p.eq(y);a=p.data("m2b-options");Q(p,y[0])}}})(jQuery);