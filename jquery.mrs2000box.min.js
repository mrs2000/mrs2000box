(function(b){jQuery.fn.mrs2000box=function(a){function L(){h=b(".m2b-shadow");0==h.length?(h=b('<div class="m2b-shadow"></div>'),h.appendTo("body").click(t),d=b('<div class="m2b-frame"><div class="m2b-shadow2"></div><div class="m2b-spinner"><div class="m2b-double-bounce1"></div><div class="m2b-double-bounce2"></div></div><img class="m2b-image"><div class="m2b-error"></div><div class="m2b-left"></div><div class="m2b-right"></div><div class="m2b-btn-close"></div><div class="m2b-title"></div></div>'),
d.appendTo("body")):(d=b(".m2b-frame"),d.show(),h.show());u=d.find(".m2b-spinner");f=d.find(".m2b-image");f.hide().load(M).click(N);m=d.find(".m2b-left");n=d.find(".m2b-right");m.click(B);n.click(C);p=d.find(".m2b-title");(a.showTitle||a.showNumber)&&p.show();v=d.find(".m2b-error");v.hide();x=d.find(".m2b-btn-close");x.click(t);g=new Image;g.onload=function(){q?(k=g.naturalWidth,l=g.naturalHeight,f.attr("src",g.src).show(),D()):q=!0};g.onerror=function(){q&&(v.show(),f.hide(),u.hide(),D())};b(window).bind("resize",
E);b(document).bind("keyup",F)}function E(){if(w&&(G(),a.onResize))a.onResize({width:k,height:l,object:c[e].object,img:f})}function F(a){if(w)switch(a.which){case 27:t();break;case 37:B();break;case 39:C()}}function G(){var a=d.width(),c=d.height(),b=k/l,e,r;H&&(c-=p.outerHeight());b>a/c?(e=k>a?a:k,r=e/b):(r=l>c?c:l,e=r*b);f.css({top:.5*c-.5*r,left:.5*a-.5*e,width:e,height:r})}function M(){if(a.showNumber||a.showTitle)H=!0,p.show();if(a.onLoad)a.onLoad({width:k,height:l,object:c[e].object,img:this});
G();u.hide()}function N(){(2>c.length||!a.showGallery)&&t()}function y(){if(a.onBeforeLoad)a.onBeforeLoad({img:f});(a.showTitle||a.showNumber)&&p.html(c[e].title).hide();f.hide();u.show();v.hide();q=!0;z=e;g.src=c[e].href}function D(){1<c.length&&(q=!1,z=1==A?I():J(),g.src=c[z].href)}function J(){var a=e-1;-1==a&&(a=c.length-1);return a}function I(){var a=e+1;a==c.length&&(a=0);return a}function B(){1<c.length&&a.showGallery&&(A=0,e=J(),y())}function C(){1<c.length&&a.showGallery&&(A=1,e=I(),y())}
function K(c){var b="";a.showNumber&&c.rel&&(b+="<b>\u0424\u043e\u0442\u043e \u2116"+c.rel+"</b> ");return b+c.title}function t(){h.hide();d.hide();m.unbind("click");n.unbind("click");x.unbind("click");f.unbind("load");f.unbind("click");b(window).unbind("resize",E);b(document).unbind("keyup",F);w=!1;if(a.onClose)a.onClose()}a=b.extend({showTitle:!0,showNumber:!0,showGallery:!1,advanced:!1,onBeforeLoad:null,onLoad:null,onResize:null,onClose:null},a);a.advanced&&(a.showGallery=!0,a.showTitle=!0,a.showNumber=
!0);var u=null,h=null,f=null,d=null,m=null,n=null,x=null,p=null,v=null,c=[],e=0,g=null,A=1,k,l,H,w=!1,q=!0,z;return b(this).each(function(){var d;if("A"==this.tagName){d=b(this).parent();if(d.data("m2b"))return;d.data("m2b",!0)}else d=b(this);d.on("click","a",function(b){b.preventDefault();L();c=[];if(a.showGallery){var f=this;d.find("a").each(function(a,b){b==f&&(e=a);c.push({object:b,href:b.href,title:K(b)})})}else c.push({object:this,href:this.href,title:K(this)});1<c.length&&a.showGallery?(m.show(),
n.show()):(m.hide(),n.hide());y();w=!0})})}})(jQuery);