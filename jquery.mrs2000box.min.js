(function(b){jQuery.fn.mrs2000box=function(a){function L(){h=b(".m2b-shadow");0==h.length?(h=b('<div class="m2b-shadow"></div>'),h.appendTo("body").click(t),d=b('<div class="m2b-frame"><div class="m2b-shadow2"></div><div class="m2b-spinner"><div class="m2b-double-bounce1"></div><div class="m2b-double-bounce2"></div></div><img class="m2b-image"><div class="m2b-error"></div><div class="m2b-left"></div><div class="m2b-right"></div><div class="m2b-btn-close"></div><div class="m2b-title"></div></div>'),
d.appendTo("body")):(d=b(".m2b-frame"),d.show(),h.show());u=d.find(".m2b-spinner");f=d.find(".m2b-image");f.hide().load(M).click(N);n=d.find(".m2b-left");p=d.find(".m2b-right");n.click(B);p.click(C);q=d.find(".m2b-title");(a.showTitle||a.showNumber)&&q.show();v=d.find(".m2b-error");v.hide();x=d.find(".m2b-btn-close");x.click(t);g=new Image;g.onload=function(){r?(k=g.naturalWidth,l=g.naturalHeight,f.attr("src",g.src).show(),D()):r=!0};g.onerror=function(){r&&(v.show(),f.hide(),u.hide(),D())};b(window).bind("resize",
E);b(document).bind("keyup",F)}function E(){if(w&&(G(),a.onResize))a.onResize({width:k,height:l,object:c[e].object,img:f})}function F(m){if(w)switch(m.which){case 27:t();break;case 37:B();break;case 39:C()}}function G(){var m=d.width(),a=d.height(),c=k/l,b,e;H&&(a-=q.outerHeight());c>m/a?(b=k>m?m:k,e=b/c):(e=l>a?a:l,b=e*c);f.css({top:.5*a-.5*e,left:.5*m-.5*b,width:b,height:e})}function M(){if(a.showNumber||a.showTitle)if(H=!0,q.show(),a.onLoad)a.onLoad({width:k,height:l,object:c[e].object,img:this});
G();u.hide()}function N(){(2>c.length||!a.showGallery)&&t()}function y(){(a.showTitle||a.showNumber)&&q.html(c[e].title).hide();f.hide();u.show();v.hide();r=!0;z=e;g.src=c[e].href}function D(){1<c.length&&(r=!1,z=1==A?I():J(),g.src=c[z].href)}function J(){var a=e-1;-1==a&&(a=c.length-1);return a}function I(){var a=e+1;a==c.length&&(a=0);return a}function B(){1<c.length&&a.showGallery&&(A=0,e=J(),y())}function C(){1<c.length&&a.showGallery&&(A=1,e=I(),y())}function K(c){var b="";a.showNumber&&c.rel&&
(b+="<b>\u0424\u043e\u0442\u043e \u2116"+c.rel+"</b> ");return b+c.title}function t(){h.hide();d.hide();n.unbind("click");p.unbind("click");x.unbind("click");f.unbind("load");f.unbind("click");b(window).unbind("resize",E);b(document).unbind("keyup",F);w=!1}a=b.extend({showTitle:!0,showNumber:!0,showGallery:!1,advanced:!1,onLoad:null,onResize:null},a);a.advanced&&(a.showGallery=!0,a.showTitle=!0,a.showNumber=!0);var u=null,h=null,f=null,d=null,n=null,p=null,x=null,q=null,v=null,c=[],e=0,g=null,A=1,
k,l,H,w=!1,r=!0,z;return b(this).each(function(){var d;if("A"==this.tagName){d=b(this).parent();if(d.data("m2b"))return;d.data("m2b",!0)}else d=b(this);d.on("click","a",function(b){b.preventDefault();L();c=[];if(a.showGallery){var f=this;d.find("a").each(function(a,b){b==f&&(e=a);c.push({object:b,href:b.href,title:K(b)})})}else c.push({object:this,href:this.href,title:K(this)});1<c.length&&a.showGallery?(n.show(),p.show()):(n.hide(),p.hide());y();w=!0})})}})(jQuery);